<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>BeanGPT | Marcel Blijleven</title>






<link rel="stylesheet" href="/css/index.35dbb91b4658fec8c693d9ab005682d95e1b3c975106cb4fa0ab29047e3ffbf6.css">


      <script src="/js/main.js"></script>


  
  
    
    
    
    
  
  
  <link href="//fonts.googleapis.com/css?family=Inconsolata:400,400i,700,700i" rel="stylesheet">




</head>
<body className="bg-white text-black antialiased dark:bg-gray-950 dark:text-white">
  <header>
    <h1>Marcel Blijleven</h1>

  <nav>
    <ul>
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a aria-current="true" class="ancestor" href="/blog/">Blog</a>
    </li>
    </ul>
  </nav>


  </header>
  <main>
    
  <h1>BeanGPT</h1>

  
  
  <time datetime="2023-12-31T00:00:00&#43;00:00">December 31, 2023</time>

  <p>Had a couple of hours to spare and thought it might be fun to use OpenAI to keep track of my coffee purchases.
I had never worked with the OpenAI API before, so this seemed like a fun project to spent 2-3 hours on.</p>
<h2 id="the-data">The data</h2>
<p>I&rsquo;m using Beanconqueror for the data. I already wrote the parsers for both Beanstats and my website, so it was very quick
to set up. Since the raw data is too much to process, I transferred the data into text and provided instructions to the OpenAI API.</p>
<p>An entry would look like this: <code>coffee: lord voldemort;3;200;16.2, bean information: colombia;wush wush;natural;huila;null;deiro garcia;null;</code>.</p>
<p>The values are: name, rating, weight, price, country, variety, processing, region, farm, farmer, elevation.</p>
<h2 id="the-chat">The chat</h2>
<p>After uploading a Beanconqueror zip file, BeanGPT will create two <code>system</code> messages to instruct the OpenAI API. The first message
contains the instruction where I explain the data, the second message is the coffee data. These messages are always sent to the API, but
the frontend filters these messages.</p>
<p>Any subsequent messages are sent as a <code>user</code> message, allowing me to chat with my coffee stats üòÑ‚òïÔ∏è.</p>
<h2 id="the-result">The result</h2>
<p><img src="images/beangpt.png" alt="beangpt"></p>
<p><img src="images/beangpt-2.png" alt="beangpt-2"></p>
<p><img src="images/beangpt-3.png" alt="beangpt-3"></p>
<h2 id="the-code">The code</h2>
<p>Project was set up using T3, using TypeScript and Tailwind. I also included Shadcn&rsquo;s component library.
The code can be found at my <a href="https://github.com/marcelblijleven/beangpt">Github page</a>.</p>
<p>The backend is fairly simple, a Next.js API route which sends the messages to OpenAI with the <code>stream</code> option set to true.
Vercel&rsquo;s AI SDK then converts the response to a <code>ReadableStream</code> using the <code>StreamingTextResponse</code> helper.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#fe8019">import</span> {OpenAIStream, StreamingTextResponse} <span style="color:#fe8019">from</span> <span style="color:#b8bb26">&#34;ai&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#fe8019">import</span> {<span style="color:#fe8019">type</span> Messages, streamChat} <span style="color:#fe8019">from</span> <span style="color:#b8bb26">&#34;~/lib/openai/stream&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">export</span> <span style="color:#fe8019">const</span> runtime <span style="color:#fe8019">=</span> <span style="color:#b8bb26">&#34;edge&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">interface</span> RequestWithJSON <span style="color:#fe8019">extends</span> Request {
</span></span><span style="display:flex;"><span>  json<span style="color:#fe8019">:</span> () <span style="color:#fe8019">=&gt;</span> Promise<span style="color:#fe8019">&lt;</span>{messages: <span style="color:#fabd2f">Messages</span>}<span style="color:#fe8019">&gt;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">export</span> <span style="color:#fe8019">async</span> <span style="color:#fe8019">function</span> POST(req: <span style="color:#fabd2f">RequestWithJSON</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#fe8019">const</span> { messages } <span style="color:#fe8019">=</span> <span style="color:#fe8019">await</span> req.json();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#fe8019">const</span> res <span style="color:#fe8019">=</span> <span style="color:#fe8019">await</span> streamChat(messages);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#928374;font-style:italic">// Convert to stream and return
</span></span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic"></span>  <span style="color:#fe8019">const</span> stream <span style="color:#fe8019">=</span> OpenAIStream(res);
</span></span><span style="display:flex;"><span>  <span style="color:#fe8019">return</span> <span style="color:#fe8019">new</span> StreamingTextResponse(stream);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The AI SDK provides a <code>useChat</code> hook which makes it easy to generate a chat interface in the frontend</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#b8bb26">&#34;use client&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">import</span> {useChat} <span style="color:#fe8019">from</span> <span style="color:#b8bb26">&#34;ai/react&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#fe8019">import</span> {Input} <span style="color:#fe8019">from</span> <span style="color:#b8bb26">&#34;~/components/ui/input&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#fe8019">import</span> {ChatMessages} <span style="color:#fe8019">from</span> <span style="color:#b8bb26">&#34;~/components/chat/messages&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#fe8019">import</span> {useMessageStore} <span style="color:#fe8019">from</span> <span style="color:#b8bb26">&#34;~/components/upload-form/store&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fe8019">export</span> <span style="color:#fe8019">default</span> <span style="color:#fe8019">function</span> Chat() {
</span></span><span style="display:flex;"><span>  <span style="color:#fe8019">const</span> initialMessages <span style="color:#fe8019">=</span> useMessageStore(state <span style="color:#fe8019">=&gt;</span> state.messages)
</span></span><span style="display:flex;"><span>  <span style="color:#fe8019">const</span> {messages, input, handleInputChange, handleSubmit} <span style="color:#fe8019">=</span> useChat({
</span></span><span style="display:flex;"><span>    initialMessages,
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#fe8019">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#fb4934">div</span> <span style="color:#b8bb26;font-weight:bold">className</span><span style="color:#fe8019">=</span>{<span style="color:#b8bb26">&#34;mx-auto w-full max-w-2xl&#34;</span>}&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#fb4934">ChatMessages</span> <span style="color:#b8bb26;font-weight:bold">messages</span><span style="color:#fe8019">=</span>{messages} /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#fb4934">form</span> <span style="color:#b8bb26;font-weight:bold">onSubmit</span><span style="color:#fe8019">=</span>{handleSubmit}&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#fb4934">Input</span>
</span></span><span style="display:flex;"><span>          <span style="color:#b8bb26;font-weight:bold">value</span><span style="color:#fe8019">=</span>{input}
</span></span><span style="display:flex;"><span>          <span style="color:#b8bb26;font-weight:bold">placeholder</span><span style="color:#fe8019">=</span>{<span style="color:#b8bb26">&#34;Ask me about your coffee backlog&#34;</span>}
</span></span><span style="display:flex;"><span>          <span style="color:#b8bb26;font-weight:bold">onChange</span><span style="color:#fe8019">=</span>{handleInputChange}
</span></span><span style="display:flex;"><span>          <span style="color:#b8bb26;font-weight:bold">className</span><span style="color:#fe8019">=</span>{<span style="color:#b8bb26">&#34;text-foreground&#34;</span>}
</span></span><span style="display:flex;"><span>        /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#fb4934">form</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#fb4934">div</span>&gt;
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
  
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/tags/typescript/">Typescript</a></li>
        <li><a href="/tags/nextjs/">Nextjs</a></li>
        <li><a href="/tags/openai/">Openai</a></li>
        <li><a href="/tags/code/">Code</a></li>
        <li><a href="/tags/coffee/">Coffee</a></li>
    </ul>
  </div>


  </main>
  <footer>
    <p>Copyright 2024. All rights reserved.</p>

  </footer>
</body>
</html>
